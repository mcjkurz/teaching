<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>2D Principal Component Analysis (PCA)</title>
    <script>
        window.MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']]
            },
            startup: {
                pageReady: () => {
                    return MathJax.startup.defaultPageReady();
                }
            }
        };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        /* =========================================
           BASE STYLES
           ========================================= */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f7fa;
            font-size: 14px;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        header {
            margin-bottom: 2rem;
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #2c3e50;
        }

        header p {
            font-size: 0.95rem;
            color: #666;
        }

        /* =========================================
           BUTTONS
           ========================================= */
        .btn {
            padding: 0.5rem 1rem;
            font-size: 0.85rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fff;
            color: #333;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .btn:hover {
            background: #f8f9fa;
            border-color: #aaa;
        }

        .btn.primary {
            background: #3498db;
            border-color: #3498db;
            color: white;
        }

        .btn.primary:hover {
            background: #2980b9;
        }

        .btn.success {
            background: #27ae60;
            border-color: #27ae60;
            color: white;
        }

        .btn.success:hover {
            background: #219a52;
        }

        .btn.danger {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
        }

        .btn.danger:hover {
            background: #c0392b;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn.large {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 500;
        }

        .btn.toggle {
            background: #8e44ad;
            border-color: #8e44ad;
            color: white;
            min-width: 140px;
        }

        .btn.toggle:hover {
            background: #732d91;
        }

        .btn.toggle.active {
            background: #27ae60;
            border-color: #27ae60;
        }

        .btn.toggle.active:hover {
            background: #219a52;
        }

        /* =========================================
           STEP SECTIONS
           ========================================= */
        .step-section {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 1.5rem;
        }

        .step-section.hidden {
            display: none;
        }

        .step-section h2 {
            font-size: 1.2rem;
            font-weight: 500;
            margin-bottom: 1rem;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .step-badge {
            background: #27ae60;
            color: white;
            padding: 0.2rem 0.6rem;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .step-content {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
        }

        .step-canvas {
            flex: 0 0 320px;
        }

        .step-canvas canvas {
            border: 1px solid #ddd;
            border-radius: 4px;
            background: #fafafa;
            display: block;
        }

        .step-explanation {
            flex: 1;
            min-width: 320px;
            overflow-x: hidden;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        /* Data controls */
        .data-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .point-counter {
            font-size: 0.9rem;
            color: #666;
            margin-left: auto;
        }

        .data-table {
            background: #f8f9fa;
            border-radius: 4px;
            padding: 1rem;
            max-height: 250px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th, .data-table td {
            padding: 0.3rem 0.5rem;
            text-align: right;
            border-bottom: 1px solid #e0e0e0;
        }

        .data-table th {
            font-weight: 600;
            color: #555;
        }

        /* Explanation boxes */
        .explanation-box {
            background: #f0f4f8;
            border-left: 4px solid #3498db;
            color: #2c3e50;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .explanation-box h4 {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }

        .explanation-box p {
            font-size: 0.9rem;
            color: #444;
        }

        .insight-box {
            background: #fef9e7;
            border-left: 4px solid #f39c12;
            color: #2c3e50;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .insight-box h4 {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: #d68910;
        }

        .insight-box p, .insight-box li {
            font-size: 0.85rem;
            color: #555;
        }

        .insight-box ul {
            margin-left: 1.2rem;
            margin-top: 0.5rem;
        }

        .insight-box li {
            margin-bottom: 0.3rem;
        }

        .concept-box {
            background: #eaf2f8;
            border-left: 4px solid #2980b9;
            color: #2c3e50;
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .concept-box h4 {
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
            color: #2980b9;
        }

        .concept-box p {
            font-size: 0.85rem;
            color: #444;
            margin-bottom: 0.5rem;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .math-section {
            background: #f8f9fa;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 1rem;
            margin-bottom: 1rem;
            overflow-x: auto;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .math-section h4 {
            font-size: 0.95rem;
            color: #2c3e50;
            margin-bottom: 0.75rem;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 0.5rem;
        }

        .math-content {
            font-size: 0.9rem;
            line-height: 1.8;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .math-formula {
            text-align: center;
            margin: 0.75rem 0;
            overflow-x: auto;
        }

        .computed-value {
            background: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0.5rem 0.75rem;
            margin: 0.5rem 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }

        .highlight-pc1 {
            color: #e74c3c;
            font-weight: 600;
        }

        .highlight-pc2 {
            color: #9b59b6;
            font-weight: 600;
        }

        .highlight-result {
            background: #e8f4fd;
            border-color: #3498db;
        }

        /* Continue button container */
        .continue-container {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
            text-align: center;
        }

        /* Canvas controls */
        .canvas-controls {
            margin-top: 0.75rem;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        /* Legend */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.75rem;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 4px;
            font-size: 0.8rem;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #555;
        }

        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .legend-line {
            width: 18px;
            height: 3px;
            border-radius: 2px;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        footer a {
            color: #3498db;
            text-decoration: none;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }

            .step-canvas {
                flex: 1 1 100%;
            }

            .step-explanation {
                min-width: unset;
                max-width: 100%;
            }

            .concept-box p,
            .explanation-box p,
            .insight-box p,
            .math-content p {
                word-break: break-word;
                hyphens: auto;
            }

            .computed-value {
                font-size: 0.85rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>2D Principal Component Analysis (PCA)</h1>
            <p>A step-by-step interactive walkthrough of how PCA finds the directions of maximum variance</p>
        </header>

        <!-- STEP 0: Data Input -->
        <section class="step-section" id="step0Section">
            <h2><span class="step-badge">Step 0</span> Create Your Data</h2>
            <div class="data-controls">
                <button class="btn" id="btnRandom">Random</button>
                <button class="btn" id="btnCorrelated">Correlated</button>
                <button class="btn" id="btnCircular">Circular</button>
                <button class="btn danger" id="btnClear">Clear All</button>
                <span class="point-counter">Points: <strong id="pointCount">0</strong> (min. 3 required)</span>
            </div>
            <div class="step-content">
                <div class="step-canvas">
                    <canvas id="canvas0" width="320" height="320"></canvas>
                    <p style="font-size: 0.8rem; color: #666; margin-top: 0.5rem; text-align: center;">Click to add points</p>
                </div>
                <div class="step-explanation">
                    <div class="explanation-box">
                        <h4>Raw Data Points</h4>
                        <p>Click on the canvas to add data points, or use the preset buttons. PCA will find the directions along which your data varies the most.</p>
                    </div>
                    <div class="data-table" id="dataTable">
                        <table>
                            <thead>
                                <tr><th>Point</th><th>x</th><th>y</th></tr>
                            </thead>
                            <tbody id="dataTableBody">
                                <tr><td colspan="3" style="text-align: center; color: #999;">No data yet</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="continue-container">
                <button class="btn success large" id="btnStartStep1" disabled>
                    Continue to Step 1: Center the Data ‚Üí
                </button>
            </div>
        </section>

        <!-- STEP 1: Center Data -->
        <section class="step-section hidden" id="step1Section">
            <h2><span class="step-badge">Step 1</span> Center the Data</h2>
            <div class="step-content">
                <div class="step-canvas">
                    <canvas id="canvas1" width="320" height="320"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot" style="background: #bbb;"></div> Original</div>
                        <div class="legend-item"><div class="legend-dot" style="background: #3498db;"></div> Centered</div>
                        <div class="legend-item"><div class="legend-dot" style="background: none; border: 2px solid #e74c3c; width: 8px; height: 8px;"></div> Mean</div>
                    </div>
                    <div class="canvas-controls">
                        <button class="btn toggle" id="btnToggleStep1">Show Centering</button>
                    </div>
                </div>
                <div class="step-explanation">
                    <div class="explanation-box">
                        <h4>Why Center?</h4>
                        <p>We subtract the mean from each point so the data's centroid moves to the origin (0, 0). This ensures PCA finds directions of variance <em>from the center</em> of the data.</p>
                    </div>
                    <div class="math-section">
                        <h4>Computing the Mean</h4>
                        <div class="math-content">
                            <div class="math-formula">
                                $$\boldsymbol{\mu} = \frac{1}{n} \sum_{i=1}^{n} \mathbf{x}_i = \begin{pmatrix} \bar{x} \\ \bar{y} \end{pmatrix}$$
                            </div>
                            <div class="computed-value highlight-result" id="meanComputed">
                                Computed mean: Œº = (?, ?)
                            </div>
                        </div>
                    </div>
                    <div class="math-section">
                        <h4>Centering Each Point</h4>
                        <div class="math-content">
                            <div class="math-formula">
                                $$\mathbf{x}_i^{\text{centered}} = \mathbf{x}_i - \boldsymbol{\mu}$$
                            </div>
                            <p style="font-size: 0.85rem; color: #666;">Each point is shifted so the new mean becomes (0, 0).</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="continue-container">
                <button class="btn success large" id="btnStartStep2">
                    Continue to Step 2: Compute Covariance ‚Üí
                </button>
            </div>
        </section>

        <!-- STEP 2: Covariance Matrix -->
        <section class="step-section hidden" id="step2Section">
            <h2><span class="step-badge">Step 2</span> Compute the Covariance Matrix</h2>
            <div class="step-content">
                <div class="step-canvas">
                    <canvas id="canvas2" width="320" height="320"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot" style="background: #3498db;"></div> Centered Data</div>
                        <div class="legend-item"><div class="legend-line" style="background: rgba(231,76,60,0.5);"></div> Var(x)</div>
                        <div class="legend-item"><div class="legend-line" style="background: rgba(155,89,182,0.5);"></div> Var(y)</div>
                    </div>
                    <div class="canvas-controls">
                        <button class="btn toggle" id="btnToggleStep2">Show Variance</button>
                    </div>
                </div>
                <div class="step-explanation">
                    <div class="math-section" style="border-color: #3498db;">
                        <h4>The Covariance Matrix</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem; color: #555; margin-bottom: 0.75rem;">The symbol <strong>Œ£</strong> (Greek letter "sigma") denotes the covariance matrix:</p>
                            <!-- Visual matrix with color coding -->
                            <div style="display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 0.75rem; margin: 1rem 0;">
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.5rem;">Œ£ =</span>
                                    <div style="display: flex; align-items: center;">
                                        <span style="font-size: 3rem; font-weight: 200;">(</span>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px;">
                                            <div style="background: #ffe6e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 500; color: #c0392b;">Var(x)</div>
                                            <div style="background: #fff3e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 500; color: #d68910;">Cov(x,y)</div>
                                            <div style="background: #fff3e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 500; color: #d68910;">Cov(x,y)</div>
                                            <div style="background: #f3e6ff; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 500; color: #8e44ad;">Var(y)</div>
                                        </div>
                                        <span style="font-size: 3rem; font-weight: 200;">)</span>
                                    </div>
                                </div>
                                <!-- Computed values matrix -->
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span style="font-size: 1.5rem;">=</span>
                                    <div style="display: flex; align-items: center;">
                                        <span style="font-size: 3rem; font-weight: 200;">(</span>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 4px; font-family: 'Courier New', monospace;">
                                            <div id="covMatVarX" style="background: #ffe6e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 600; color: #c0392b;">?</div>
                                            <div id="covMatCovXY1" style="background: #fff3e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 600; color: #d68910;">?</div>
                                            <div id="covMatCovXY2" style="background: #fff3e6; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 600; color: #d68910;">?</div>
                                            <div id="covMatVarY" style="background: #f3e6ff; padding: 8px 12px; border-radius: 4px; text-align: center; font-weight: 600; color: #8e44ad;">?</div>
                                        </div>
                                        <span style="font-size: 3rem; font-weight: 200;">)</span>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin: 1rem 0;">
                                <div style="flex: 1; min-width: 200px; padding: 0.75rem; background: #ffe6e6; border-radius: 6px; border-left: 4px solid #e74c3c;">
                                    <strong style="color: #e74c3c;">Diagonal: Variance</strong><br>
                                    <span style="font-size: 0.85rem;">How much each variable spreads on its own axis</span>
                                    <ul style="font-size: 0.8rem; margin: 0.5rem 0 0 1rem; color: #555;">
                                        <li>Large Var(x) ‚Üí wide horizontal spread</li>
                                        <li>Large Var(y) ‚Üí wide vertical spread</li>
                                    </ul>
                                </div>
                                <div style="flex: 1; min-width: 200px; padding: 0.75rem; background: #fff3e6; border-radius: 6px; border-left: 4px solid #f39c12;">
                                    <strong style="color: #f39c12;">Off-diagonal: Covariance</strong><br>
                                    <span style="font-size: 0.85rem;">How variables move together</span>
                                    <ul style="font-size: 0.8rem; margin: 0.5rem 0 0 1rem; color: #555;">
                                        <li>Cov > 0 ‚Üí upward slope (‚Üó)</li>
                                        <li>Cov < 0 ‚Üí downward slope (‚Üò)</li>
                                        <li>Cov ‚âà 0 ‚Üí no relationship</li>
                                    </ul>
                                </div>
                            </div>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">The matrix is symmetric: Cov(x,y) = Cov(y,x). It encodes the "shape" of the data cloud.</p>
                        </div>
                    </div>
                    <div class="math-section">
                        <h4>Formula: How to Compute the Matrix</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">The covariance matrix is built from <strong>outer products</strong> of centered vectors:</p>
                            <div class="math-formula">
                                $$\Sigma = \frac{1}{n-1} \sum_{i=1}^{n} (\mathbf{x}_i - \boldsymbol{\mu})(\mathbf{x}_i - \boldsymbol{\mu})^T$$
                            </div>
                            <p style="font-size: 0.85rem; color: #666; margin: 0.5rem 0;">For each point, we compute a 2√ó2 matrix (outer product), then average them:</p>
                            <div class="math-formula">
                                $$\begin{pmatrix} x_i \\ y_i \end{pmatrix} \begin{pmatrix} x_i & y_i \end{pmatrix} = \begin{pmatrix} x_i^2 & x_i y_i \\ y_i x_i & y_i^2 \end{pmatrix}$$
                            </div>
                            <p style="font-size: 0.85rem; color: #666;">Summing these matrices gives: diagonal = sum of squares (variance), off-diagonal = sum of products (covariance). Notice that $x_i y_i = y_i x_i$, so the covariance matrix is always <strong>symmetric</strong>.</p>
                        </div>
                    </div>
                    <div class="math-section">
                        <h4>Your Computed Covariance Matrix</h4>
                        <div class="math-content">
                            <div class="computed-value highlight-result" id="covMatrixComputed">
                                Œ£ = [ [?, ?], [?, ?] ]
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <div class="computed-value" id="varXComputed" style="flex: 1;">Var(x) = ?</div>
                                <div class="computed-value" id="varYComputed" style="flex: 1;">Var(y) = ?</div>
                            </div>
                            <div class="computed-value" id="covXYComputed">Cov(x,y) = ?</div>
                            <div class="computed-value" id="covInterpretation" style="font-style: italic; background: #fffbe6; border-color: #ffe58f;">
                                Interpretation: ...
                            </div>
                        </div>
                    </div>

                    <!-- Interactive Covariance Explorer -->
                    <div class="insight-box" style="background: #f0f7ff; border-left-color: #3498db; margin-top: 1.5rem;">
                        <h4 style="color: #2980b9;">üéõÔ∏è Interactive: Explore the Covariance Matrix</h4>
                        <p style="margin-bottom: 0.5rem;">We can think of the covariance matrix as a <strong>transformation</strong> that shapes data. Starting from a circular cloud of points (Var(x)=Var(y)=1, Cov=0), the matrix stretches, squashes, and rotates it into an ellipse.</p>
                        <p id="covExplorerDataHint" style="margin-bottom: 1rem; padding: 0.5rem; background: #e8f4fc; border-radius: 4px; font-size: 0.85rem;"><strong>Your data:</strong> Var(x)=?, Var(y)=?, Cov=? ‚Äî try these values to see the transformation that produces your data's shape!</p>
                        
                        <div style="display: flex; gap: 1.5rem; flex-wrap: wrap; align-items: flex-start;">
                            <div style="flex: 0 0 200px;">
                                <canvas id="covExplorerCanvas" width="200" height="200" style="border: 1px solid #ccc; border-radius: 6px; background: #fafafa;"></canvas>
                                <div style="text-align: center; font-size: 0.75rem; color: #666; margin-top: 0.25rem;">Ellipse shows 2œÉ contour</div>
                            </div>
                            
                            <div style="flex: 1; min-width: 220px;">
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 0.25rem;">
                                        <span style="color: #e74c3c; font-weight: 600;">Var(x)</span>
                                        <span id="varXSliderVal" style="font-family: monospace;">1.00</span>
                                    </label>
                                    <input type="range" id="varXSlider" min="0.1" max="3" step="0.01" value="1" 
                                        style="width: 100%; accent-color: #e74c3c;">
                                    <div style="font-size: 0.75rem; color: #888;">Horizontal spread</div>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 0.25rem;">
                                        <span style="color: #9b59b6; font-weight: 600;">Var(y)</span>
                                        <span id="varYSliderVal" style="font-family: monospace;">1.00</span>
                                    </label>
                                    <input type="range" id="varYSlider" min="0.1" max="3" step="0.01" value="1" 
                                        style="width: 100%; accent-color: #9b59b6;">
                                    <div style="font-size: 0.75rem; color: #888;">Vertical spread</div>
                                </div>
                                
                                <div style="margin-bottom: 1rem;">
                                    <label style="display: flex; justify-content: space-between; font-size: 0.85rem; margin-bottom: 0.25rem;">
                                        <span style="color: #f39c12; font-weight: 600;">Cov(x,y)</span>
                                        <span id="covXYSliderVal" style="font-family: monospace;">0.00</span>
                                    </label>
                                    <input type="range" id="covXYSlider" min="-3" max="3" step="0.01" value="0" 
                                        style="width: 100%; accent-color: #f39c12;">
                                    <div id="covRangeHint" style="font-size: 0.75rem; color: #888;">Valid range: [‚àí1.00, 1.00] ‚Äî variables can't co-vary more than they each vary on their own (Cov¬≤ ‚â§ Var(x)¬∑Var(y))</div>
                                </div>
                                
                                <div style="background: #fff; border: 1px solid #ddd; border-radius: 4px; padding: 0.5rem; font-size: 0.8rem;">
                                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                                        <span style="font-size: 1.1rem;">Œ£ =</span>
                                        <span style="font-size: 1.5rem; font-weight: 200;">(</span>
                                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2px; font-family: monospace;">
                                            <span id="covMatDisplay00" style="background: #ffe6e6; padding: 2px 6px; border-radius: 2px; text-align: center;">1.00</span>
                                            <span id="covMatDisplay01" style="background: #fff3e6; padding: 2px 6px; border-radius: 2px; text-align: center;">0.00</span>
                                            <span id="covMatDisplay10" style="background: #fff3e6; padding: 2px 6px; border-radius: 2px; text-align: center;">0.00</span>
                                            <span id="covMatDisplay11" style="background: #f3e6ff; padding: 2px 6px; border-radius: 2px; text-align: center;">1.00</span>
                                        </div>
                                        <span style="font-size: 1.5rem; font-weight: 200;">)</span>
                                    </div>
                                    <div id="covExplorerInfo" style="margin-top: 0.5rem; color: #555; font-style: italic;">
                                        Equal variances, no correlation ‚Üí circular distribution
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="continue-container">
                <button class="btn success large" id="btnStartStep3">
                    Continue to Step 3: Find Principal Components ‚Üí
                </button>
            </div>
        </section>

        <!-- STEP 3: Eigenvalues, Eigenvectors & Ellipse (Combined) -->
        <section class="step-section hidden" id="step3Section">
            <h2><span class="step-badge">Step 3</span> Find Principal Components (Eigenvalues & Eigenvectors)</h2>
            <div class="step-content">
                <div class="step-canvas">
                    <canvas id="canvas3" width="320" height="320"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot" style="background: #3498db;"></div> Centered Data</div>
                        <div class="legend-item"><div class="legend-line" style="background: #e74c3c;"></div> PC1 (Œª‚ÇÅ)</div>
                        <div class="legend-item"><div class="legend-line" style="background: #9b59b6;"></div> PC2 (Œª‚ÇÇ)</div>
                        <div class="legend-item"><div class="legend-line" style="background: rgba(155,89,182,0.5); border: 1px dashed #9b59b6;"></div> Ellipse</div>
                    </div>
                    <div class="canvas-controls">
                        <button class="btn toggle" id="btnToggleStep3PC1">Show PC1</button>
                        <button class="btn toggle" id="btnToggleStep3PC2">Show PC2</button>
                        <button class="btn toggle" id="btnToggleStep3Ellipse">Show Ellipse</button>
                    </div>
                </div>
                <div class="step-explanation">
                    <div class="explanation-box">
                        <h4>The Goal: Find the Principal Components</h4>
                        <p>Principal components are the <strong>eigenvectors</strong> of the covariance matrix ‚Äî they point in the directions of maximum variance. But to find eigenvectors, we first need to find the <strong>eigenvalues</strong> (Œª). The eigenvalue tells us how much variance exists along its eigenvector. The largest eigenvalue's eigenvector becomes PC1.</p>
                    </div>
                    
                    <div class="math-section">
                        <h4>Step 3a: Set Up the Characteristic Equation</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">An eigenvector v satisfies <strong>Œ£v = Œªv</strong>, which rearranges to <strong>(Œ£ - ŒªI)v = 0</strong>. For non-zero v to exist, the matrix (Œ£ - ŒªI) must be singular:</p>
                            <div class="math-formula">
                                $$\det(\Sigma - \lambda I) = 0$$
                            </div>
                            <p style="font-size: 0.85rem;">For our 2√ó2 covariance matrix:</p>
                            <div class="math-formula">
                                $$\det\begin{pmatrix} \text{Var}(x) - \lambda & \text{Cov}(x,y) \\ \text{Cov}(x,y) & \text{Var}(y) - \lambda \end{pmatrix} = 0$$
                            </div>
                        </div>
                    </div>

                    <div class="concept-box">
                        <h4>What is the Determinant?</h4>
                        <p>For a 2√ó2 matrix $\begin{pmatrix} a & b \\ c & d \end{pmatrix}$, the determinant is $ad - bc$. Geometrically, the determinant measures how much a transformation "scales area":</p>
                        <p>‚Ä¢ <strong>Det = 0:</strong> The matrix squashes space onto a line ‚Äî it loses a dimension entirely</p>
                        <p>‚Ä¢ <strong>Det ‚â† 0:</strong> The matrix is invertible ‚Äî no dimension is completely lost</p>
                        <p style="margin-top: 0.5rem;"><strong>Why we need it:</strong> To find eigenvalues, we solve det(Œ£ - ŒªI) = 0. We're looking for values of Œª that make this matrix <em>singular</em> (det = 0), meaning it collapses some direction. Those Œª values are the eigenvalues.</p>
                        <p style="margin-top: 0.5rem;"><strong>Why not just drop the x or y axis?</strong> We could simply ignore one coordinate, but that would be wasteful. If your data spreads diagonally (i.e., if there is correlation), dropping x loses half the information and dropping y loses the other half. Can we do better and lose less information? Yes, by first <em>rotating</em> our coordinate system to align with the directions where the data varies most, then dropping the direction with the least variance. The eigenvectors tell us exactly how to rotate: they point along the data's principal axes. This way, we keep the direction with maximum variance (PC1) and only discard the direction (PC2) where the data barely varies anyway.</p>
                    </div>

                    <div class="concept-box">
                        <h4>What det(Œ£) Tells Us About Our Data</h4>
                        <p>Since <strong>det(Œ£) = Œª‚ÇÅ √ó Œª‚ÇÇ</strong> (product of eigenvalues):</p>
                        <p>‚Ä¢ <strong>det(Œ£) near 0:</strong> One eigenvalue must be small ‚Üí data is nearly 1D (highly correlated) ‚Üí PCA projection loses little information</p>
                        <p>‚Ä¢ <strong>det(Œ£) larger:</strong> Both eigenvalues are substantial ‚Üí data genuinely spreads in 2D ‚Üí PCA projection loses more information</p>
                        <p style="margin-top: 0.5rem;">The key comparison is: <strong>how small is det relative to the total variance?</strong> A ratio Œª‚ÇÅ/Œª‚ÇÇ tells us the elongation of the data ellipse.</p>
                    </div>

                    <div class="math-section">
                        <h4>Step 3b: Expand to Get a Quadratic Equation</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">Applying the determinant formula $ad - bc$ to our matrix:</p>
                            <div class="math-formula">
                                $$(\text{Var}(x) - \lambda)(\text{Var}(y) - \lambda) - \text{Cov}(x,y)^2 = 0$$
                            </div>
                            <p style="font-size: 0.85rem;">Expanding $(a-\lambda)(b-\lambda) = ab - a\lambda - b\lambda + \lambda^2$ gives us a <strong>quadratic equation in Œª</strong>:</p>
                            <div class="math-formula">
                                $$\lambda^2 - \underbrace{(\text{Var}(x) + \text{Var}(y))}_{\text{trace}} \lambda + \underbrace{(\text{Var}(x) \cdot \text{Var}(y) - \text{Cov}(x,y)^2)}_{\text{determinant}} = 0$$
                            </div>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">This quadratic has two solutions ‚Äî those are our two eigenvalues Œª‚ÇÅ and Œª‚ÇÇ.</p>
                            <div class="computed-value" id="charEqComputed" style="font-size: 0.8rem;">
                                Substituting your values: ...
                            </div>
                        </div>
                    </div>
                    
                    <div class="concept-box">
                        <h4>What is the Trace?</h4>
                        <p><strong>Trace = Var(x) + Var(y)</strong> ‚Äî the sum of the diagonal elements.</p>
                        <p>The trace represents the <em>total variance</em> in your data. Notice it appears as the coefficient of Œª in the quadratic equation above. Importantly, <strong>trace = Œª‚ÇÅ + Œª‚ÇÇ</strong> ‚Äî the eigenvalues partition the total variance between the principal components.</p>
                    </div>

                    <div class="math-section">
                        <h4>Step 3c: Solve Using the Quadratic Formula</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem;">Our equation $\lambda^2 - \text{trace} \cdot \lambda + \text{det} = 0$ is a standard quadratic $ax^2 + bx + c = 0$.</p>
                            <div class="computed-value" id="traceDetComputed">
                                trace(Œ£) = ?, &nbsp; det(Œ£) = ?
                            </div>
                            <div class="computed-value" id="traceDetInterpret" style="font-style: italic; background: #fffbe6; border-color: #ffe58f;">
                                What this means: ...
                            </div>
                            <p style="font-size: 0.85rem; margin-top: 0.5rem;">Using the quadratic formula $x = \frac{-b \pm \sqrt{b^2 - 4ac}}{2a}$:</p>
                            <div class="math-formula">
                                $$\lambda = \frac{\text{trace} \pm \sqrt{\text{trace}^2 - 4 \cdot \text{det}}}{2}$$
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <div class="computed-value highlight-result" id="lambda1Computed" style="flex: 1;">
                                    <span class="highlight-pc1">Œª‚ÇÅ = ?</span> (PC1 - larger)
                                </div>
                                <div class="computed-value highlight-result" id="lambda2Computed" style="flex: 1;">
                                    <span class="highlight-pc2">Œª‚ÇÇ = ?</span> (PC2 - smaller)
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="math-section">
                        <h4>Step 3d: Find Eigenvectors</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">For each Œª, solve <strong>(Œ£ - ŒªI)v = 0</strong>:</p>
                            <div class="math-formula">
                                $$\begin{pmatrix} \text{Var}(x) - \lambda & \text{Cov}(x,y) \\ \text{Cov}(x,y) & \text{Var}(y) - \lambda \end{pmatrix} \begin{pmatrix} v_x \\ v_y \end{pmatrix} = \begin{pmatrix} 0 \\ 0 \end{pmatrix}$$
                            </div>
                            <p style="font-size: 0.85rem;">From the first row: $(\text{Var}(x) - \lambda)v_x + \text{Cov}(x,y) \cdot v_y = 0$</p>
                            <p style="font-size: 0.85rem; margin-bottom: 0.5rem;">Solving and normalizing gives:</p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <div class="computed-value highlight-result" id="v1Computed" style="flex: 1;">
                                    <span class="highlight-pc1">v‚ÇÅ = (?, ?)</span>
                                </div>
                                <div class="computed-value highlight-result" id="v2Computed" style="flex: 1;">
                                    <span class="highlight-pc2">v‚ÇÇ = (?, ?)</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="insight-box">
                        <h4>The Variance Ellipse</h4>
                        <ul>
                            <li>The ellipse axes align with the eigenvectors (PC1 and PC2)</li>
                            <li>Axis lengths are proportional to ‚àöŒª (standard deviation along each direction)</li>
                            <li><strong>Elongated ellipse:</strong> PC1 captures most variance</li>
                            <li><strong>Nearly circular:</strong> Both PCs are equally important</li>
                        </ul>
                    </div>

                    <div class="math-section">
                        <h4>Variance Explained</h4>
                        <div class="math-content">
                            <div class="math-formula">
                                $$\text{Variance explained by PC}_i = \frac{\lambda_i}{\lambda_1 + \lambda_2} \times 100\%$$
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <div class="computed-value highlight-result" id="var1Explained" style="flex: 1;">
                                    <span class="highlight-pc1">PC1: ?%</span>
                                </div>
                                <div class="computed-value highlight-result" id="var2Explained" style="flex: 1;">
                                    <span class="highlight-pc2">PC2: ?%</span>
                                </div>
                            </div>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap; margin-top: 0.5rem;">
                                <div class="computed-value" id="axis1Computed" style="flex: 1;">
                                    <span class="highlight-pc1">‚àöŒª‚ÇÅ = ?</span> (PC1 std dev)
                                </div>
                                <div class="computed-value" id="axis2Computed" style="flex: 1;">
                                    <span class="highlight-pc2">‚àöŒª‚ÇÇ = ?</span> (PC2 std dev)
                                </div>
                            </div>
                            <div class="computed-value" id="angleComputed">
                                Rotation angle Œ∏ = ?¬∞
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="continue-container">
                <button class="btn success large" id="btnStartStep4">
                    Continue to Step 4: Project Data ‚Üí
                </button>
            </div>
        </section>

        <!-- STEP 4: Project Data (was Step 5) -->
        <section class="step-section hidden" id="step4Section">
            <h2><span class="step-badge">Step 4</span> Project onto Principal Component</h2>
            <div class="step-content">
                <div class="step-canvas">
                    <canvas id="canvas4" width="320" height="320"></canvas>
                    <div class="legend">
                        <div class="legend-item"><div class="legend-dot" style="background: #3498db;"></div> Original (2D)</div>
                        <div class="legend-item"><div class="legend-dot" style="background: #27ae60;"></div> Projected (1D)</div>
                        <div class="legend-item"><div class="legend-line" style="background: rgba(231,76,60,0.4);"></div> PC1 Line</div>
                    </div>
                    <div class="canvas-controls">
                        <button class="btn toggle" id="btnToggleStep4">Show Projection</button>
                    </div>
                </div>
                <div class="step-explanation">
                    <div class="explanation-box">
                        <h4>Dimensionality Reduction</h4>
                        <p>By projecting each point onto PC1, we reduce 2D data to 1D while keeping the direction of maximum variance. The distance from each original point to its projection represents the information "lost" (variance along PC2).</p>
                    </div>
                    <div class="insight-box">
                        <h4>The Trade-off</h4>
                        <ul>
                            <li><strong>High PC1 variance:</strong> Little information lost in projection</li>
                            <li><strong>Low PC2 variance:</strong> The "lost" dimension didn't carry much signal anyway</li>
                            <li><strong>This is compression:</strong> We go from 2 numbers per point to 1 number.</li>
                        </ul>
                    </div>
                    <div class="math-section">
                        <h4>Projection Formula</h4>
                        <div class="math-content">
                            <p style="font-size: 0.85rem;">To project point <strong>x</strong> onto PC1 (eigenvector <strong>v‚ÇÅ</strong>):</p>
                            <div class="math-formula">
                                $$\mathbf{x}_{\text{proj}} = \underbrace{(\mathbf{x} \cdot \mathbf{v}_1)}_{\text{scalar score}} \cdot \underbrace{\mathbf{v}_1}_{\text{direction}}$$
                            </div>
                        </div>
                    </div>
                    <div class="insight-box">
                        <h4>Why Multiply by v‚ÇÅ Again?</h4>
                        <p>The projection happens in <strong>two steps</strong> with different purposes:</p>
                        <ul>
                            <li><strong>Step 1: Dot product (x ¬∑ v‚ÇÅ)</strong> ‚Üí gives a <em>scalar</em> (single number). This is the "score" or coordinate in the new 1D space. If you only want dimensionality reduction, you can stop here.</li>
                            <li><strong>Step 2: Multiply by v‚ÇÅ</strong> ‚Üí converts the scalar back to a <em>2D point</em>. This tells us WHERE on the PC1 line the projection lands (for visualization or reconstruction).</li>
                        </ul>
                        <p style="margin-top: 0.5rem;"><strong>Example:</strong> If score = 2.5 and v‚ÇÅ = (0.8, 0.6), then:</p>
                        <p style="margin-left: 1rem;">‚Ä¢ Score alone: just "2.5" (1D representation)</p>
                        <p style="margin-left: 1rem;">‚Ä¢ Projected point: 2.5 √ó (0.8, 0.6) = (2.0, 1.5) (location in 2D)</p>
                    </div>
                    <div class="math-section">
                        <h4>Information Retained vs Lost</h4>
                        <div class="math-content">
                            <div class="computed-value highlight-result" id="infoRetained">
                                <span class="highlight-pc1">Information retained (PC1): ?%</span>
                            </div>
                            <div class="computed-value" id="infoLost">
                                <span class="highlight-pc2">Information lost (PC2): ?%</span>
                            </div>
                            <p style="font-size: 0.85rem; color: #666; margin-top: 0.5rem;">
                                This is the core tradeoff of PCA: we sacrifice some variance (information) for a lower-dimensional representation.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="continue-container">
                <button class="btn primary large" id="btnRestart">
                    ‚Ü∫ Start Over with New Data
                </button>
            </div>
        </section>

        <footer>
            <a href="../index.html">‚Üê Back to Home Page</a>
        </footer>
    </div>

    <script src="../scripts/pca-2d.js"></script>
</body>
</html>
